---
- name: Validate distribution (CentOS or Oracle Linux)
  meta: end_host
  when: ansible_distribution != 'CentOS' and ansible_distribution != 'OracleLinux'

- name: Validate Release Version (6.10, 7.9, 8.4)
  meta: end_host
  when: ansible_distribution_version != '6.10' and ansible_distribution_version != '7.9' and ansible_distribution_version != '8.4'

- name: Download Red Hat GPG key
  get_url:
    url: "https://www.redhat.com/security/data/fd431d51.txt"
    dest: "/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release"

- name: Add Convert2RHEL repofile
  yum_repository:
    name: convert2rhel
    description: Convert2RHEL for OS {{ ansible_distribution_major_version }}
    baseurl: "http://ftp.redhat.com/pub/redhat/convert2rhel/{{ ansible_distribution_major_version }}/os/"
    enabled: yes
    gpgcheck: yes
    gpgkey: "file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release"

- name: Install convert2rhel for RHEL {{ ansible_distribution_major_version }} from yum repo
  yum:
    name: "convert2rhel"
    state: latest